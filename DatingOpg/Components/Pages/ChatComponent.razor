@page "/chat/{profileId:int}"
@using DatingOpg.Models
@using DatingOpg.Services
@inject ChatService ChatService
@inject AuthHelperService AuthHelperService

<PageTitle>Chat</PageTitle>

<h3>Chat</h3>

@if (messages == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div>
        @foreach (var message in messages)
        {
            <div>@message.Sender.UserName: @message.Message</div>
        }
    </div>
    <div>
        <textarea @bind="newMessage" class="form-control" rows="3"></textarea>
        <button class="btn btn-primary mt-2" @onclick="SendMessage">Send</button>
    </div>
}

@code {
    [Parameter]
    public int ProfileId { get; set; }

    private List<Chat> messages;
    private string newMessage;

    protected override async Task OnInitializedAsync()
    {
        messages = await ChatService.GetMessagesAsync(ProfileId);
    }

    private async Task SendMessage()
    {
        await ChatService.SendMessageAsync(ProfileId, newMessage);
        newMessage = string.Empty;
        messages = await ChatService.GetMessagesAsync(ProfileId);
    }
}
